%%% Clinic Statement of Work Template
%%%
%%% C.M. Connelly <cmc@math.hmc.edu>
%%%
%%%  $Id: statement-of-work-template.tex 353 2010-08-23 23:47:44Z cmc $


%%% !!! HMC STUDENTS SHOULD REMOVE THE FOLLOWING COPYRIGHT NOTICE FROM
%%% !!! FINAL SUBMISSIONS.

%%% Copyright (C) 2004-2010 Department of Mathematics, Harvey Mudd College.
%%%
%%% This file is part of the hmcclinic class document provided to
%%% HMC mathematics students.
%%%
%%% See the COPYING document, which should accompany this
%%% distribution, for information about distribution and
%%% modification of the document and its components.

%%% !!! END COPYRIGHT NOTICE.


%%% Clinic reports use the clinic class, which should be located
%%% somewhere in TeX's search path.

%%% For your ``statement of work'' (or ``work statement''), specify
%%% the ``proposal'' document-class option to the hmcclinic class.
\documentclass[proposal]{hmcclinic}

%%% The major difference between the statement of work and a midyear
%%% or final report is that the statement of work is typeset as an
%%% article, which means that the highest level of structural
%%% division available to you is section rather than chapter.

%%% There are also some changes in pagination styles and content
%%% that reflect the briefer nature of the proposal.  For example,
%%% in the longer reports, you use \frontmatter, \mainmatter, and
%%% \backmatter to separate some sections of the report from
%%% others.  In the statement of work, you don't need those
%%% commands, as no such division is necessary.

%%% Other packages needed by your document may be loaded here.
% \usepackage{url}              % For formatting URLs and other web or
                                % file references.

%%% Provide additional context around errors.
\setcounter{errorcontextlines}{1000}


%%% Information about this document.

%%% I find it most useful to put identifying information about a
%%% document near the top of the preamble.  Technically, this
%%% information must precede the \maketitle command, which often
%%% appears immediately after the beginning of the document
%%% environment.  Placing it near the top of the document makes it
%%% easier to identify the document, and keeps it out from getting
%%% mixed up with the real meat of the document.

%%% We use the same set of commands for specifying information about
%%% the people involved with the project that are used in the longer
%%% reports, so you can copy most of this information directly into
%%% your midyear and final reports.

%%% So, some questions.

%% What is the name of the company or organization sponsoring your project?
\sponsor{Sandia National Laboratories}

%% What is the title of your report?
\title{Statement of Work}

%% Who are the authors of the report (your team members)?  (Separate
%% names with \and.)
\author{Brett Collins (Project Manager) \and Alex Gruver \and Ellen Hui \and
Tyler Marklyn}

%% What is your faculty advisor's name?  (Again, separate names with
%% \and, if necessary.)
\advisor{Jeff Amelang}

%% Liaison's name or names?
\liaison{Carter Edwards \and Robert Hoekstra}

%% Did you have an outside consultant help you with this project?  Put
%% their names in the \consultant command.

%%% End of information section.

%%% New commands and environments.

%%% You can define your own commands and environments here.  If you
%%% have a lot of material here, you might want to consider splitting
%%% the commands and environments into a separate ``style'' file that
%%% you load with \usepackage.

\newcommand{\coolcommand}[1]{#1 is cool.} % Lets everyone know that
                                % the person or thing that you provide
                                % as the argument to the command is
                                % cool.


%%% Some theorem-like command definitions.

%%% The \newtheorem command comes from the amsthm package.  That
%%% package is loaded by the class file.

%%% Note that these definitions have changed from the version in the
%%% sample report document by dropping the ``within'' argument.  See
%%% Gratzer's _Math into LaTeX_ or the AMS-LaTeX documentation for
%%% more details.

% \newtheorem{thm}{Theorem}
% \newtheorem{Theo1}{Theorem}
% \newtheorem{Theo2}{Theorem}
% \newtheorem{Lemma}{Lemma}


%%% If you find that some words in your document are being hyphenated
%%% incorrectly, you can specify the correct hyphenation using the
%%% \hyphenation command.  Note that words are separated by
%%% whitespace, as shown below.

\hyphenation{ap-pen-dix wer-ther-i-an}


%%% The start of the document!

%% The document environment is the main environment in any LaTeX
%% document.  It contains other environments, as well as your text.

\begin{document}

%%% In a longer document (such as your midterm and final reports),
%%% you would have separate \frontmatter, \mainmatter, and
%%% \backmatter commands to define some large chunks of your
%%% document.  For the Statement of Work, which is a short document,
%%% we don't need these commands.

%%% Your Statement of Work begins with a title page.  The title page
%%% is formatted by commands in the document class file, so you
%%% don't need to worry about what it looks like -- just putting the
%%% \maketitle command in your document (and filling in the necessary
%%% information for the identification commands above) is enough.
\maketitle

%%% In a longer document or an article being submitted to a journal
%%% or conference, you would probably have an abstract that
%%% summarized the purpose of the document.  We don't need that for
%%% a Statement of Work.

%%% Similarly, in longer documents you would probably have commands
%%% to include a table of contents and lists of figures or tables.
%%% For a short document such as the Statement of Work, we don't
%%% need these commands.


%%% Content.

%%% For smaller documents---especially those you're writing by
%%% yourself---you might write your entire report using a single LaTeX
%%% source file.  For larger documents, we recommend that you split
%%% the source file into several separate, smaller files.  The smaller
%%% files are ``included'' into your main, or ``master'' document
%%% using \include commands.  See the template file for the Clinic
%%% reports for more details on how to split a LaTeX project into
%%% smaller files.


%%% The body of your Statement of Work should appear here.  See
%%% Chapter 4 in _The Mathematics Clinic in Brief: A Handbook_ for
%%% more details on what you should include in a Statement of Work.

\section{Problem Statement}

Sandia National Laboratories currently has many libraries and legacy code that
do not utilize new multicore architectures. Using their Kokkos library, which
was designed to make it possible and easy to port code to new architectures
(specifically multicore architectures), we will make a tensor contractions
library and, as time permits, other libraries thread scalable.

\section{Background}

Sandia National Laboratories is a federally funded research and development
center owned and managed by the Sandia Corporation.  The laboratory's primary
focus is the maintenance, management, and development of the United States'
nuclear arsenal.  Sandia also performs research in the fields of supercomputing
and scientific computing.  The Trilinos Project, developed and maintained by
Sandia, is a collection of open source libraries intended for use in large-scale
scientific applications.

One of the packages in Trilinos is Kokkos, which is designed to aid portability
and performance in software written for manycore architectures.  The vast
majority of scientific codes produced and used by the national labs rely on
message passing parallelism to leverage both inter-node and intra-node
parallelism.  Until the present, this approach of using MPI across a single node
sacrifices some performance for the ease of a monolithic programming model, and
the performance penalty has not been high enough to motivate the usage of
threads instead of processes.  However, as the exascale push hits the power
wall, interest has been growing in the area of using higher-performing and less
power-hungry co-processors on each node, still with message passing across
nodes.  Unfortunately, this means that codes will have to be re-written, as
message-passing cannot be used to leverage the parallelism of coprocessors such
as Graphical Processing Units (GPUs). GPUs are characterized by high thread
counts, decreased memory per thread, and relatively small instruction sets when
compared to CPUs. These differences lead to many advantages when it comes to
high performance computing. Since GPUs have a smaller instruction set, they can
devote more of their transistors to arithmetic computation. This means that GPUs
are capable of executing significantly more floating point operations per second
(flops). Additionally, GPUs use less power than CPUs, which makes them appealing
for supercomputers, where power consumption is a major concern.

Well implemented GPU code can yield significant speedup in certain
processing-heavy applications.  However, the ways in which an algorithm must be
optimized to run on a GPU is highly dependent on hardware architecture.  In
addition, highly parallel code may suffer from race conditions between threads,
causing either incorrect results or slower runtimes resulting from the steps
necessary to ensure correctness.

Kokkos attempts to mitigate these issues by allowing programmers to write their
code once, and compile for optimization on a variety of manycore architectures.
This is possible because the library manages the allocation of memory for the
programmer and optimizes storage for speed on the target architecture. Kokkos
also allows users to write thread scalable software by providing an API for
using fast, non-locking data structures.

However, the Kokkos package is still new and relatively untested.  No
large-scale projects have yet been written with it.  Some small kernels have
been rewritten using Kokkos, but there are still many kernels in Trilinos that
would benefit from increased thread scalable parallelization.

\section{Goal}

The goal of this clinic is to rewrite several kernels from libraries within
Trilinos to be efficient and thread-scalable on manycore architectures, using
Kokkos.  These redesigned and reimplemented kernels will be integrated into
Trilinos' production code, as both a performance improvement and as a use case
for Kokkos.

We plan on reengineering a tensor contraction library within Trilinos named
Intrepid. The Intrepid package is a library of kernels designed for use by
developers who want to reuse large parts of their existing code frameworks while
gaining access to state of the art tools for compatible discretizations of
partial differential equations. Once we have I incorporating Kokkos into
Intrepid and demonstrated measurable performance and usability improvements, we
plan on incorporating Kokkos into the salient kernels of another library within
Trilinos.  The second library will deal with either graph analytics or solving
algebraic multigrid systems.
\section{Objectives}

The primary goal of this clinic is to update Intrepid's tensor
manipulation for thread scalability using Kokkos. After this, we will begin work
on one of the secondary options listed above. This goal can
be broken down into a couple different objectives.
\begin{itemize}
    \item First, our team will familiarize ourselves with Kokkos' structure and
        usage by implementing several warm up algorithms with different memory
        access patterns.  We also plan on doing performance comparisons with
        serial CPU implementations to learn the most effective mechanisms for
        parallel speedup.
    \item Our second major objective will be use what we have learned about
        massively parallel code to speed up Intrepid's tensor contraction
        kernel.
    \item The third and final objective of this project is to speed up another
        kernel from Intrepid.  This kernel will be focused on one of the
        following.
        \begin{itemize}
            \item graph analytics
            \item algebraic multigrid solving
        \end{itemize}
\end{itemize}

\subsection{Optional Objectives}

The optional objectives presented in this section are to be done if time
permits. Firstly, if the team has finished, or has made significant progress
towards making Sandia's tensor manipulation library thread scalable, then the
team will present their methods and results to a group of Sandia employees
during the winter site visit.  After we've finished work on the Intrepid
kernels, there are a couple different objectives we can pursue.  The first
possible objective is to continue making more of Sandia's libraries
thread-scalable. Another possibility is to code versions of the Intrepid
libraries in CUDA, or another framework such as OpenCL, in order to compare
their performance with the Kokkos' implementations. The performance tests can
show the strengths and weaknesses of Kokkos and give information that is useful
to the developers of Kokkos.

\section{Tasks}

Our first task for this semester was to acquire a desktop with suitable
computational capabilities. We have ordered a machine with an NVIDIA K20 Tesla
Card, Intel Phi 5110p Co-processor, and a 8-Core Ivy Bridge Processor. This
computer should allow us to test NVIDIA's GPU computing platform as well as
Intel's, and allow us to compare the performance of our code on GPUs to the Ivy
Bridge's traditional
8-Core hardware.

After this, we will try to familiarize ourselves with massively multithreaded
programming by working through a series of example problems in a variety of
environments. So far, we have identified the following problems as likely candidates.
\begin{itemize}
	\item scalar integration
	\item histogram calculations
	\item calculating polynomials for a long list of x values and coefficients.
	\item naive matrix multiplication
	\item smart matrix multiplication
	\item scalar product of two second order tensors
	\item contraction of fourth order tensor with second order tensor
\end{itemize}
The last of these problems should prepare us to work with the Intrepid library, since these
two problems are indicative of the types of kernels we will be working with.

For all of these problems, we intend on creating the following solutions
\begin{itemize}
	\item fast serial
	\item implementation using Intel's Threaded Building Blocks
	\item implementation using OpenMP
	\item implementation using Cuda
	\item implementation using Kokkos
\end{itemize}
After familiarizing ourselves with TBB, CUDA and OpenMP, we will have a
background to understand the ideal way to write code using Kokkos. At this
point, we will begin to write solutions to our practice problems using Kokkos.
We can then compare the speedup gains on Kokkos compared to the other libraries,
and also the ease of writing thread scalable code using Kokkos compared to the
other libraries. This will be good practice for applying the same process to
Intrepid kernels, to thoroughly evaluate performance improvement and ease of
coding.

At this point, we will shift our focus to our first kernel.  After we implement
the practice problems mentioned above we should have a good idea of where to go
with the tensor contraction implementation. Tensor contraction is very similar
to smart matrix multiplication in particular.  We will need to explore the main
algorithms used for tensor contraction and determine if there are existing
procedures for parallelizing the process. The original Kokkos source code, along
with online materials should help us with this.

Once we are familiar with Kokkos, and we feel we have enough of a background
with the technologies, we will begin working on improving the tensor contraction
library. At this point in the project it is difficult to create an accurate
timeline for this process, but we hope that we will be able to present our
progress at the end of semester site visit at Sandia.

After the tensor contraction library we will continue work on one of the
Intrepid kernels previously mentioned. We hope that we will be able to
accomplish significant speedup in this secondary library after we finish work on
tensor contraction.
%%% Appendices.

%%% For your Statement of Work, you probably won't have any
%%% appendices, but you could include some if you really needed to.

%%% The appendices are delineated with the \appendix command.
%%% Individual appendices are begun with the standard \chapter or
%%% \section commands.  In our example, we'll \include them just as we
%%% did other chapters.

%%% Even in a relatively short document such as your statement of
%%% work, you might need to have appendices.  If so, uncomment
%%% the \appendix command and add them below (remember, the
%%% top-level structural command in this format is section).

% \appendix


%%% Bibliography.

%%% BibTeX is the tool to use for citations and layout of your
%%% bibliography.  Instead of having to type ``[5]'' or ``(Jones,
%%% 1968)'' (and keep track of which citation is which and renumber
%%% them as you add more references to your bibilography), you use
%%% special commands that allow BibTeX and LaTeX to automatically put
%%% the correct information in the right place.

%%% Section 5.6 in _The Mathematics Clinic in Brief: A Handbook_,
%%% talks about using BibTeX to format your bibliography and
%%% citations.

%%% Depending on your field, it may or may not be appropriate to list
%%% references for which you haven't included specific citations.  If
%%% your field sanctions such practices, or if you just want to get an
%%% idea of what you have in your bibliography file, you can include
%%% everything with the \nocite{*} command.
\nocite{*} 


%%% The appearance of your bibliography and citations in your text are
%%% defined by a combination of any bibliography-related LaTeX
%%% packages (such as natbib, harvard, or chicago) and the particular
%%% bibliography style file that you load with the \bibliographystyle
%%% command.  Bibliography-style files end in .bst; you can find them
%%% by searching your file system using whatever tools you have for
%%% doing searches.  (On most modern Unices, ``locate .bst'' will give
%%% you an idea of what's available.)

\bibliographystyle{hmcmath}

%%% The particular bibliography data file or files that you want to
%%% use are specified with the \bibliography file.  Multiple files are
%%% separated by commas.

%%% You might want to use multiple bibliography (or ``bib'') files if
%%% you had a master bib file containing references you use again and
%%% again, and another containing only records for references for a
%%% particular project.

%%% Many people create a single, large bib file that they use for
%%% everything they write.  That approach requires you to \cite every
%%% reference that you want to use in your document -- using
%%% \nocite{*} with a huge bibliography database will give you a large
%%% bibliography containing many references you haven't consulted for
%%% your particular document!

\bibliography{sample}


%%% Glossary or Index.

%%% Having a glossary or index in a statement of work is overkill.
%%% Just define your terms in the text and you'll be fine.

\end{document}

